# Default values for transaction-validator

replicaCount: 3

image:
  repository: your-registry/transaction-validator
  pullPolicy: IfNotPresent
  tag: "v1.0.0"

serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: "" # Set via --set in deployment
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 3000
  fsGroup: 2000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

service:
  type: ClusterIP
  port: 8080
  metricsPort: 9090

ingress:
  enabled: true
  className: alb
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/healthcheck-path: /health/ready
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: '15'
    # Add your certificate ARN
    # alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:..."
  hosts:
    - host: api.transaction-validator.example.com
      paths:
        - path: /
          pathType: Prefix

resources:
  limits:
    cpu: 2000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

livenessProbe:
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health/ready
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 2

startupProbe:
  httpGet:
    path: /health/startup
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 12

# Pod Disruption Budget
pdb:
  enabled: true
  minAvailable: 2

# Network Policy
networkPolicy:
  enabled: true

# Environment variables
env:
  LOG_LEVEL: "info"
  MAX_TRANSACTIONS_PER_SECOND: "1000"
  PORT: "8080"
  METRICS_PORT: "9090"
  TRANSACTION_TIMEOUT_MS: "30000"
  VALIDATION_RETRY_ATTEMPTS: "3"

# Secrets from AWS Secrets Manager
secrets:
  databaseUrl: ""
  redisEndpoint: ""
  redisAuthToken: ""

# Pod anti-affinity for AZ distribution
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - transaction-validator
        topologyKey: topology.kubernetes.io/zone

nodeSelector: {}

tolerations: []

